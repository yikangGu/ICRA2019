# 3 Software 软件部分

## 3.1 Environment 环境

考虑到实际的开发时间和ICRA比赛对机器人的完整性和综合性。
这意味着对于大部分重复性的工作来说，我们需要使用一些前人写的工具包来帮助我们快速开发整一个机器人算法的框架。
以至于我们放弃了独自构建框架的选项，并选择了成熟的Kinect版本的ROS作为我们在主机上的开发环境，并构建整一个机器人的算法框架。

TODO 备注清单 :

- adds the Pygame environment possible 可能添加对pygame环境的描述

同时，主机上的开发环境还配备了其他的工具包：
OpenCV工具包，用于负责机器人的视觉处理，包括装甲板的识别，机器人方位的识别(如果做得到的话)等等;
CUDA工具包，用于负责加快GPU的处理速度，这同样对视觉处理以及神经网络处理有效。
对于其他模块(比如定位模块，导航模块)，我们同样也安装了相应的工具包。

## 3.4 The modules of perception 感知模块

感知系统是一个机器人获取客观环境并作出基本行为的系统。
我们的感知系统包括一下4个部分：视觉识别，跟踪和打击，定位，导航(或路径规划)

### 3.4.1 Detection 视觉部分

视觉识别是自主移动机器人获取客观环境的重要模块之一。
对于ICRA，这也决定了机器人发现敌人，识别敌人，识别装甲板，识别障碍物等等的基本能力。
通过分析，我们对于不同的应用构建了相应的算法。
其中，识别装甲板的应用是最重要的，识别障碍物，识别敌人等还有待商榷。

**Identifying Armour Plates** :识别装甲板

装甲板的视觉模型是有两条LED组成，有着相同的长度，互相平行，和垂直方向。
LED颜色分为红色和蓝色，有着极高的亮度。

因此，我们设计识别装甲板算法的流程是先将相应的色块从图片中提取出来。
然后，过滤掉那些不符合灯条形状，平行特征，长度特征，和方向特征的色块。
同时，相互两两匹配。
最后，过滤掉其余的噪音，剩下许多符合特征且成对的色块

<div align="center">
    <img src=figures/3.4.1.1.jpg width="180px"/>
    <img src=figures/3.4.1.2.bmp width="180px"/>
</div>
<div align="center">An armour(left)，Identifying The Armour(right)</div>

设计时，我们分别测试了基于RGB和HSV的两种提取算法。
理论上，由于OpenCV存储图像方法默认是BGR3通道存储，且R和B分别为不同的通道。
纯色的值是最高的，其余的值平均都低于50，这也证明了RGB分离法的有效性。
合理设计像素指针，我们可以在OpenCV上达到最快的历遍速度，以至于RGB分离法理应被认为是比HSV分离法更直接，更有效，更快速。
测试结果也证明了RGB分离法有更高效率和更低的错误率。

实际中，由于LED灯条有很强的光源，色彩亮度很高和纯度很高，这对于一般的摄像头会造成过度曝光以至于图像中色块中心呈现白色。
因此，我们使用了可以调节参数的工业摄像头，通过降低曝光，降低亮度，减少对比度和轻微减少饱和度来达到从硬件上优化算法的效果。
这时，红色色块的识别率大幅增加，同时，装甲板的识别率也明显增加。

TODO :

- adds the obstacles detection possible 可能添加对障碍物检测的部分
- adds the identifying enemies possible 可能添加对识别敌人的部分（这里指 意识到哪个机器人）
