# 2 Hardware 硬件部分

## 2.1 Snapshort 整体方案

我们拟定采用由ICRA主办方所搭建的RM AI 机器人平台,以下简称官方机器人.
使用官方机器人的好处很多, 比如稳定性高, 开发成本低等等, 当然也缺点, 就是个性化程度不高, 并且机械设计影响了雷达的扫描范围等等.
机器人硬件部分主要由两个部分组成，机械部分和设备部分.

### **机械部分**

机械部分有包含有两个模块，底盘模块和云台模块.

| 模块 | 名称 | 数量 |
| :- | :- | :- |
| **机械部分** |
| 底盘部分 | M3508 P19 直流无刷减速电机 | 4 |
|  | C620 无刷电机调速器 | 4 |
|  | RM麦克纳姆轮左旋 | 2 |
|  | RM麦克纳姆轮右旋 | 2 |
| 云台部分 | M2006 P36 直流无刷减速电机 | 1 |
|  | GM6020 直流无刷电机 | 2 |
|  | C610 无刷电机调速器 | 1 |
| 发弹部分 | Snail 2305竞速电机	| 2 |
|  | Snail 430-R竞速电调 | 2 |

### 底盘模块

使用4个麦克纳姆轮，支持全向运动.
使用 M3508 无刷直流减速电机 和 C620 电子调速器组成底盘的动力系统.
使用 RoboMaster 开发板A型 (STM32F427IIH6) 作为主控板.

<div align="center">
    <img src=figures/chassis_mechanical.png width="360px"/>
</div>
<div align="center">底盘机械结构展示</div>

### 云台模块

采用两轴云台支持2自由度的旋转运动.
提供17mm TPU弹丸的拨弹与发射机构.
使用 GM6020 无刷电机 (及其配套电调) 组成云台动力系统.
使用 M2006 无刷直流减速电机组成拨弹动力系统.
使用 DJI Snail 2305 竞速电机组成发射动力系统.
使用 RoboMaster 开发板A型 (STM32F427IIH6) 作为主控板.

<div align="center">
    <img src=figures/gimbal_mechanical.jpeg width="270px"/>
</div>
<div align="center">云台机械结构展示</div>

### **设备部分**

设备部分为多个设备组成,包括有上位机,下位机,摄像头,雷达,超声波,电池.

| 模块 | 名称 | 数量 |
| :- | :- | :- |
| **设备部分** |
| 下位机 | RM开发板A型(STM32F427IIH6) | 2 |
| 上位机 | Intel 7代 I5 工控机 | 1 |
|  | Nvidia Jetson TX2 | 1 |
| 摄像头 | 高速500万像素工业相机 | 1 |
| 雷达 | YDLIDAR G4 | 1 |
| 超声波 | HY-SRF05 | 4 |
| 电池 | TB47D电池 | 1 |

下位机由两块 STM32F427IIH6 为核心的 RoboMaster A型开发板组成，分别使用在底盘模块和云台模块。
有着丰富的扩展接口和通信接口，板载IMU传感器，可配合M3508，M2006直流无刷减速电机以及UWB定位模块，亦可配合SDK，上位机使用。
该开发板具有防反接和缓启动等多重保护，满足比赛机器人的控制需求，也非常适合用户DIY。

<div align="center">
    <img src=figures/main_board.png width="640px"/>
</div>
<div align="center">RM A型开发板 展示</div>

上位机有两个方案, 一个是使用自行搭建的工控机, 一个是使用英伟达的Jetson Tx2产品. 
第一个方案, 自行搭建的工控机, 外壳体积为 18.5X4.5X19.75CM(W\*H\*D), 满足RM AI 机器人搭载上位机的空间要求.
主板采用Asus/华硕H110T双网卡主板,内存类型为8G DDR4.
CPU采用英特尔酷睿系列7代i5处理器.
硬盘为128G的固态硬盘.
经讨论,认为,在经费不充裕的条件下,此搭建的工控机其处理速度及性能基本满足ROS系统开发要求, 适合机器人开发并使用.
但是缺点是不支持GPU设备, 故不能进行快速的矩阵运算, 所以也不能对OpenCV进行加速

| 模块 | 名称 | 数量 |
| :- | :- | :- |
| **工控机** |
| CPU | intel7th i5 | 1 |
| 主板 | 华硕H110T主板 | 1 |
| 内存 | 4G DDR4 | 2 |
| 硬盘 | 128G SSD | 1 |

<div align="center">
    <img src=figures/E-T3.jpg width="360px"/>
</div>
<div align="center">上位机(工控机)展示</div>

另一个方案是使用英伟达的Jetson Tx2产品, 其外壳体积更加小巧, 主要处理核心采用双核Denver 2处理器和四核ARM A57处理器, 处理性能远不及intel core 7代 i5 处理器.
然而体积小巧的 Tx2 拥有英伟达帕斯卡架构256个CUDA核心的GPU.
可以说在矩阵运算上是完胜工控机的.

| 模块 | 参数 |
| :- | :- |
| **Nvidia Jetson Tx2** |
| GPU | NVIDIA Pascal™, 256 CUDA cores |
| CPU | HMP Dual Denver 2/2 MB L2 |
|  | Quad ARM® A57/2 MB L2 |
| Memory | 8 GB 128 bit LPDDR4 59.7 GB/s |
| Data Storage | 32 GB eMMC |

<div align="center">
    <img src=figures/jetson-tx2.jpg width="360px"/>
</div>
<div align="center">上位机(工控机)展示</div>

但是在上位机的最终选型上, 我们采用同时保留两种方案, 因为首先ROS系统是对CPU性能有比较大的要求, 故在Tx2上开发比较慢, 所以先在工控机上开发, 再在移植并且适配到Tx2上, 也不失为一个好方法.

由于在其他机器人比赛上的经验告诉我们, 摄像头的高速无拖影是十分重要的功能, 并且参数可调也是必要的功能之一, 同时考虑到便捷性, 所以我们初步讨论采用以下一款可支持USB3.0, 参数可调, 高速高帧率无拖影的工业摄像头.
不过缺点是分辨率不高, 只有640x480的分辨率.
但是考虑到在ICRA比赛中, 在图像中获取必要的特征(比如灯条)并不需要特别高的分辨率, 故认为, 此摄像头基本满足本次比赛要求.

雷达是YDLIDAR的G4雷达, 具有每秒9000次测距频率, 16米的测距半径, 40mm高度和12Hz扫描频率.
由于雷达是机器人获取定位信息的重要设备, 通过红外线旋转一周, 上位机获取距离信息, 再通过相关算法与现有的地图相对比, 得到定位信息.
据此, 我们在选择雷达时, 测距频率和扫描频率是我们优先考虑的参数, 而在YDLIDAR同类型的产品里, G4雷达的测距频率以及扫描频率是最高的.

超声波作为辅助设备, 是使用在机器人在补给子弹时, 对雷达定位进行补偿, 及校准用的.
HY-SRF05的超声波模块, 测距精度达到3mm, 最远测距4.5m, 最近测距0.02m, 测量角度15度.
是市场上比较成熟的产品, 所以可认为此模块满足所需的要求.

<div align="center">
    <img src=figures/camera.jpg width="200px"/>
    <img src=figures/ydlidarg4.png width="294px"/>
    <img src=figures/ultrasonic.jpg width="200px"/>
</div>
<div align="center">摄像头和雷达展示</div>
