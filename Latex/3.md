# 3 Embedded part 嵌入式部分

## 3.1 Snapshort 整体方案

下位机和上位机通过CAN2口相互通信, 上位机通过摄像头识别敌方车辆, 识别障碍物, 识别装甲板, 识别之后通过计算目标相对机器人本体的位置, 

## 3.2 Robot Base Control 机器人基本控制

移动, 取弹, 弹量检测,

### 底盘

底盘控制主控使用RM A型开发板，对单个电机的控制采用位置、速度双闭环的pid控制器，外环为位置环，每周期的目标输入是每周期的码盘步长的期望值。
在位置环外对每周期的输入期望值和每周期完成值做积分，将误差补偿到下周期的期望值上。
速度环的速度采样使用卡尔曼滤波器对速度值进行平滑处理，使得速度控制更为平滑准确。

### 云台

云台控制和底盘控制在同一块板上进行，我们将主控放在云台上。
云台同样使用位置、速度双闭环控制，云台pitch轴和yaw轴的数据采样都使用mpu6500。
首先获取惯导数据，进行低通滤波，以500Hz频率使用Mahony互补滤波器和四元数对加速度和角速度数据进行融合解算（参考px4开源飞控），得到云台姿态数据。
Yaw轴获取云台电机码盘数据，得到云台和底盘的相对角度，用于限位和校准姿态解算后的yaw轴。
用mpu6050做观测器的优势在于可以轻松做到扭腰模式。

## 2.3 Robot Gimbal Control 机器人云台控制
