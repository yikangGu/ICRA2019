# 3 Software 软件部分

## 3.1 Environment 环境

Consider the development time we have and the comprehensive requires to the robots of the competition, an excisting/open-sourse toolkits would be use during the development to avoid a bunch of repetitive works. So far we have abandoned the choice of building a framework oursleves, instead, choosing the Kinect version of ROS as the development environment for the host computer to build an algorithm framework.

TODO list:

- Pygame environment might need to be installed 

Toolkits that require on the host development environment: 
- OpenCV library 
For visual processing, including armour detection, robot orientation recognition (if it is possible).

- CUDA toolkit 
For speed up the GPU processing speed, that include visual and neural network processing.

- Other modules such as the positioning and the navigation module  
Corresponding toolkits shall be installed

## 3.4 Perception module

The perception system is a system that processing the sensory input, which transforms these low-level information to higher-level information, thus, taking further action.
Our perception system consist of four parts: Detection, Tracking and attacking, Positioning, Navigation.

### 3.4.1 Detection

Visual detection is one of the most important method for autonomous mobile robots in perceive the environment.
In ICRA competition, visual detection will be using on enemies identification, armour detection and obstacles highlight.
We might using different algorithms on different objects detection.（etc: armour, obstacles and robots） 

Armour detection has the highest priority, robots identification and obstacle highlight remains to be descussed.

**Armour Detection** :识别装甲板

The visual model of the armour is composed of two LED strips, each of them has the same length, parallel to each other and vertical to the ground.

Amour has two different colours red and blue, both of the brightness are extremely high.
Therefore, we need to extract the corresponding colour blocks in the image first.

Then, filter out the non-conforming colour blocks according to the shape of the light bar, parallel features, length features, and direction features. We are going to match each other bar at the same time.

Lastly, filtered out all the remaining noise, leaving many pairs of colour blocks that conform to the features.

<div align="center">
    <img src=figures/3.4.1.1.jpg width="180px"/>
    <img src=figures/3.4.1.2.bmp width="180px"/>
</div>
<div align="center">An armour(left)，Identifying The Armour(right)</div>

During the design, we had tested both algorithms based on RGB and HSV gamut extraction.
Generally, the image storage in OpenCV defaults to BGR three-channel storage, the R and B for different channels.
The highest value for pure colour and the remaining values are below 50 on average, which also proves the effectiveness of the RGB separation method.
By using well-design pixel pointer, we could achieve the fastest processor speed on OpenCV, so the RGB separation method should be considered more effective than HSV separation method.The test result also shows that the RGB separation method has higher efficiency and lower false rate compare with HIS sepration method(PLS show the test result here).

In actual testting, the colour brightness and the purity are extremely high, which might causing the normal camera overexposed so that the imaging result of the centre colour of the light bar would geting white.
Therefore, we might using an industrial camera with adjustable parameters. By lowering the brightness and exposure, increasing the contrast and slightly adjusting the saturation to achieve the algorithm optimisation effect at the hardware level.
After the adjusting, the red colour block recognition rate would greatly increased as well as the identification rate of armour.

TODO :

- obstacles highlight might need to be installed
- robot identification might need to be installed 
