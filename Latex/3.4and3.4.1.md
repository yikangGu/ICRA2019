# 3 Software

## 3.1 Environment

Consider the integrity and comprehensiveness of the robots required for the ICRA competition and active development time.
This means that for much repetitive work, we need to use the toolkits that others have built to help us quickly build the overall framework of the robot algorithm.
So far we have abandoned the choice of building a framework alone and chose the mature Kinect version of ROS as the development environment for the host computer, and the algorithm framework for building the entire robot.

TODO :

- adds the Pygame environment possible

At the same time, the host development environment equipped with the other toolkits.
The OpenCV library for robotic visual processing, including armor plate recognition, robot orientation recognition (possible), and so on.
The CUDA toolkit is used to speed up GPU processing and is equally useful for visual processing and neural network processing.
For other modules (such as the positioning module, the navigation module),  we also installed the corresponding toolkits.

## 3.4 The modules of perception

The perception system is a system that processes the fundamental behavior of a robot and obtains information from an objective environment.
Our perception system consists of four parts: Detection, Tracking and Hitting, Positioning, Navigation.

### 3.4.1 Detection

Visual perception is one of the important modules for autonomous mobile robots to perceive the objective environment.
For ICRA, it also determines the fundamental ability to discover enemies, identify enemies, identify armor plates, identify obstacles, and so on.
After analysis, we construct corresponding algorithms for different applications.
Among them, the application of identifying armor plates is most important, the application and achieve of detecting obstacles and identifying enemies remains to be discussed.

Identifying Armor Plates：
The visual model of the armor plate is composed of two LED strips, which are equal in length, parallel to each other, and vertical in direction.
The colors divided into red and blue, and the brightness is extremely high.

Therefore, the general flow of our design of the armor plate recognition algorithm is to extract the corresponding color blocks in the image.
Moreover, filter out the non-conforming color blocks according to the shape of the light bar, parallel features, length features, and direction features.
At the same time, match each other. Finally, all remaining noise is filtered out, leaving many pairs of color blocks that match the feature.

<div align="center">
    <img src=figures/3.4.1.1.jpg width="180px"/>
    <img src=figures/3.4.1.2.bmp width="180px"/>
</div>
<div align="center">An armor(left)，Identifying The Armor(right)</div>

In the design, we tested both algorithms based on RGB and HSV gamut extraction.
In theory, the image storage in OpenCV defaults to BGR three-channel storage, the R and B for different channels.
The highest value for pure color and the remaining values are below 50 on average, which also proves the effectiveness of the RGB separation method.
Reasonable design of the pixel pointer, we can achieve the fastest processor speed on OpenCV, so the RGB separation method should be considered more direct and effective, and the rate is faster than HSV separation method.
The test results also show that the RGB separation method has higher efficiency and lower false positive rate.

In practice, due to the strong LED light source, the color brightness is extremely high, and the purity is extremely high, which may cause the general camera to be overexposed so that the imaging result of the center color of the light bar becomes white.
Therefore, we use an industrial camera with adjustable parameters, by lowering the exposure, lowering the brightness, increasing the contrast, and slightly adjusting the saturation to achieve the algorithm optimization effect at the hardware level.
At this time, the red color block recognition rate Greatly increased, at the same time, the identification rate of armor plates has also increased significantly.